<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:core="clr-namespace:BaseLogApp.Core.Models"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:Class="BaseLogApp.Views.JumpsPage"
             Title="Logbook"
             BackgroundColor="#0A0F1E">

    <Grid RowDefinitions="Auto,*" Padding="16,12,16,0">
        <Border BackgroundColor="#151B2E" StrokeThickness="0" StrokeShape="RoundRectangle 16" Padding="8,2">
            <SearchBar x:Name="Search"
                       Placeholder="Cerca per numero, data, oggetto, tipo, note..."
                       Text="{Binding Query, Mode=TwoWay}" />
        </Border>

        <CollectionView Grid.Row="1"
                        ItemsSource="{Binding FilteredItems}"
                        SelectionMode="None"
                        Margin="0,14,0,0">
            <CollectionView.ItemsLayout>
                <LinearItemsLayout Orientation="Vertical" ItemSpacing="12" />
            </CollectionView.ItemsLayout>

            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="core:JumpListItem">
                    <SwipeView>
                        <SwipeView.LeftItems>
                            <SwipeItems Mode="Reveal">
                                <SwipeItem Text="Modifica"
                                           BackgroundColor="#2D8CFF"
                                           Invoked="OnEditJumpInvoked"
                                           CommandParameter="{Binding .}" />
                            </SwipeItems>
                        </SwipeView.LeftItems>
                        <SwipeView.RightItems>
                            <SwipeItems Mode="Reveal">
                                <SwipeItem Text="Elimina"
                                           BackgroundColor="#C62828"
                                           Invoked="OnDeleteJumpInvoked"
                                           CommandParameter="{Binding .}" />
                            </SwipeItems>
                        </SwipeView.RightItems>

                        <Border StrokeThickness="0"
                                BackgroundColor="#151B2E"
                                StrokeShape="RoundRectangle 16"
                                Padding="0"
                                Margin="0">
                            <toolkit:Expander>
                                <toolkit:Expander.Header>
                                    <Grid Padding="12" ColumnDefinitions="64,*,Auto" RowDefinitions="Auto,Auto,Auto" ColumnSpacing="12" RowSpacing="2">
                                        <Label Grid.RowSpan="3"
                                               Text="{Binding NumeroSalto}"
                                               FontSize="34"
                                               FontAttributes="Bold"
                                               TextColor="White"
                                               VerticalTextAlignment="Start" />

                                        <Label Grid.Column="1"
                                               Text="{Binding Oggetto}"
                                               FontSize="21"
                                               FontAttributes="Bold"
                                               TextColor="White"
                                               LineBreakMode="TailTruncation" />
                                        <Label Grid.Column="2"
                                               Text="{Binding Data}"
                                               FontSize="14"
                                               TextColor="#8E99B8"
                                               HorizontalTextAlignment="End" />

                                        <Label Grid.Row="1" Grid.Column="1"
                                               Text="{Binding TipoSalto}"
                                               FontSize="16"
                                               TextColor="#D8DEEF" />

                                        <Label Grid.Row="1" Grid.Column="2"
                                               Text="{Binding TimeDisplay}"
                                               FontSize="14"
                                               TextColor="#8E99B8"
                                               HorizontalTextAlignment="End" />

                                        <Label Grid.Row="2" Grid.Column="1" Grid.ColumnSpan="2"
                                               Text="{Binding Note}"
                                               FontSize="14"
                                               MaxLines="1"
                                               LineBreakMode="TailTruncation"
                                               TextColor="#8E99B8" />
                                    </Grid>
                                </toolkit:Expander.Header>

                                <VerticalStackLayout Padding="12,0,12,12" Spacing="10">
                                    <BoxView HeightRequest="1" BackgroundColor="#27314E" />

                                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="10">
                                        <Label Text="Numero" TextColor="#8E99B8" />
                                        <Label Grid.Column="1" Text="{Binding NumeroSalto}" TextColor="White" FontAttributes="Bold" />
                                    </Grid>
                                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="10">
                                        <Label Text="Oggetto" TextColor="#8E99B8" />
                                        <Label Grid.Column="1" Text="{Binding Oggetto}" TextColor="White" />
                                    </Grid>
                                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="10">
                                        <Label Text="Tipo" TextColor="#8E99B8" />
                                        <Label Grid.Column="1" Text="{Binding TipoSalto}" TextColor="White" />
                                    </Grid>
                                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="10">
                                        <Label Text="Data" TextColor="#8E99B8" />
                                        <Label Grid.Column="1" Text="{Binding Data}" TextColor="White" />
                                    </Grid>

                                    <Label Text="Foto / preview" TextColor="#8E99B8" FontSize="12" />
                                    <Image Source="{Binding ObjectPhotoSource}"
                                           HeightRequest="120"
                                           Aspect="AspectFill">
                                        <Image.GestureRecognizers>
                                            <TapGestureRecognizer Tapped="OnPhotoTapped" CommandParameter="{Binding .}" />
                                        </Image.GestureRecognizers>
                                    </Image>

                                    <Label Text="Note complete" TextColor="#8E99B8" FontSize="12" />
                                    <Label Text="{Binding Note}" TextColor="#D8DEEF" />

                                    <Grid ColumnDefinitions="*,Auto" Margin="0,4,0,0">
                                        <Label Grid.Column="1"
                                               Text="ðŸ”’"
                                               FontSize="22"
                                               TextColor="#D8DEEF">
                                            <Label.GestureRecognizers>
                                                <TapGestureRecognizer Tapped="OnLockEditTapped" CommandParameter="{Binding .}" />
                                            </Label.GestureRecognizers>
                                        </Label>
                                    </Grid>
                                </VerticalStackLayout>
                            </toolkit:Expander>
                        </Border>
                    </SwipeView>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    </Grid>
</ContentPage>
